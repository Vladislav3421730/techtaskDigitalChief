services:

  app:
    image: 'docker-spring-boot-postgres:latest'
    build:
      context: .
    container_name: 'app'
    depends_on:
      - 'postgres'
    environment:
      - 'SPRING_DATASOURCE_URL=jdbc:postgresql://postgres:5432/techtaskdb'
      - 'SPRING_DATASOURCE_USERNAME=postgres'
      - 'SPRING_DATASOURCE_PASSWORD=postgres'
      - 'SPRING_JPA_HIBERNATE_DDL_AUTO=none'
      - 'SPRING_JPA_HIBERNATE_SHOW_SQL=true'
    ports:
      - '8080'

  postgres:
    container_name: 'postgres'
    image: 'postgres:13-alpine'
    ports:
      - '5432'
    environment:
      - 'POSTGRES_DB=techtaskdb'
      - 'POSTGRES_USER=postgres'
      - 'POSTGRES_PASSWORD=postgres'

  elasticsearch:
    container_name: 'elasticsearch'
    image: 'docker.elastic.co/elasticsearch/elasticsearch:8.5.3'
    environment:
      - 'discovery.type=single-node'
      - 'ES_JAVA_OPTS=-Xms512m -Xmx512m'
      - 'xpack.security.enabled=false'
    ports:
      - '9200:9200'
    ulimits:
      memlock:
        soft: -1
        hard: -1
